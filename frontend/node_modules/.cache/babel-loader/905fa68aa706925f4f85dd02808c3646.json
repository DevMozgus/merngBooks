{"ast":null,"code":"var _jsxFileName = \"/home/niko/Documents/web/portfolio/merngBooks/frontend/src/App.js\";\nimport React, { useState, useEffect } from 'react';\nimport Authors from './components/Authors';\nimport Books from './components/Books';\nimport Recommended from './components/Recommended';\nimport NewBook from './components/NewBook';\nimport LoginForm from './components/LoginForm';\nimport { useApolloClient, useSubscription } from '@apollo/client';\nimport { BOOK_ADDED } from './mutations';\nimport { ALL_BOOKS } from './queries';\n\nconst App = () => {\n  const [page, setPage] = useState('authors');\n  const [error, setError] = useState(null);\n  const [token, setToken] = useState(null);\n  const client = useApolloClient();\n\n  const updateCacheWith = addedBook => {\n    const includeIn = (set, object) => set.map(b => b.id).includes(object.id);\n\n    const dataInStore = client.readQuery({\n      query: ALL_BOOKS\n    });\n\n    if (!includeIn(dataInStore.allBooks, addedBook)) {\n      client.writeQuery({\n        query: ALL_BOOKS,\n        data: {\n          allBooks: dataInStore.allBooks.concat(addedBook)\n        }\n      });\n    }\n  };\n\n  useSubscription(BOOK_ADDED, {\n    onSubscriptionData: ({\n      subscriptionData\n    }) => {\n      const addedBook = subscriptionData.data.bookAdded;\n      window.alert(`${addedBook.title} has been added`);\n      updateCacheWith(addedBook);\n    }\n  });\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"current-user-token\");\n    if (storedToken) setToken(storedToken);\n  }, []);\n\n  const handleLogout = () => {\n    setToken(null);\n    localStorage.clear();\n    client.resetStore();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Notify, {\n    error: error,\n    setError: setError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }\n  }, !token ? /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setPage('login'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }\n  }, \"login\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => handleLogout(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 9\n    }\n  }, \"log out\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setPage('add'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 9\n    }\n  }, \"add book\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setPage('recommended'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 9\n    }\n  }, \"recommended\")), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setPage('authors'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, \"authors\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setPage('books'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }\n  }, \"books\")), /*#__PURE__*/React.createElement(LoginForm, {\n    setError: setError,\n    setToken: setToken,\n    show: page === \"login\",\n    setPage: setPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Authors, {\n    show: page === 'authors',\n    setError: setError,\n    token: token,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Books, {\n    show: page === 'books',\n    setError: setError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Recommended, {\n    show: page === 'recommended',\n    setError: setError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(NewBook, {\n    show: page === 'add',\n    setError: setError,\n    updateCacheWith: updateCacheWith,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }\n  }));\n};\n\nconst Notify = ({\n  error,\n  setError\n}) => {\n  if (!error) return null;\n  setTimeout(() => setError(null), 3000);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      color: 'red'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 5\n    }\n  }, error);\n};\n\nexport default App;","map":{"version":3,"sources":["/home/niko/Documents/web/portfolio/merngBooks/frontend/src/App.js"],"names":["React","useState","useEffect","Authors","Books","Recommended","NewBook","LoginForm","useApolloClient","useSubscription","BOOK_ADDED","ALL_BOOKS","App","page","setPage","error","setError","token","setToken","client","updateCacheWith","addedBook","includeIn","set","object","map","b","id","includes","dataInStore","readQuery","query","allBooks","writeQuery","data","concat","onSubscriptionData","subscriptionData","bookAdded","window","alert","title","storedToken","localStorage","getItem","handleLogout","clear","resetStore","Notify","setTimeout","color"],"mappings":"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","sourcesContent":["\nimport React, { useState, useEffect } from 'react'\nimport Authors from './components/Authors'\nimport Books from './components/Books'\nimport Recommended from './components/Recommended'\nimport NewBook from './components/NewBook'\nimport LoginForm from './components/LoginForm'\nimport { useApolloClient, useSubscription } from '@apollo/client';\nimport { BOOK_ADDED } from './mutations'\nimport { ALL_BOOKS } from './queries'\n\nconst App = () => {\n  const [page, setPage] = useState('authors')\n  const [error, setError] = useState(null)\n  const [token, setToken] = useState(null)\n  const client = useApolloClient()\n\n  const updateCacheWith = (addedBook) => {\n    const includeIn = (set, object) => \n      set.map(b => b.id).includes(object.id)\n\n    const dataInStore = client.readQuery({ query: ALL_BOOKS })\n    if(!includeIn(dataInStore.allBooks, addedBook)) {\n      client.writeQuery({\n        query: ALL_BOOKS,\n        data: { allBooks: dataInStore.allBooks.concat(addedBook)}\n      })\n    }\n  }\n\n  useSubscription(BOOK_ADDED, {\n    onSubscriptionData: ({subscriptionData}) => {\n      const addedBook = subscriptionData.data.bookAdded\n      window.alert(`${addedBook.title} has been added`)\n      updateCacheWith(addedBook)\n    }\n  })\n\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"current-user-token\")\n    if (storedToken) setToken(storedToken)\n  }, [])\n\n  const handleLogout = () => {\n    setToken(null)\n    localStorage.clear()\n    client.resetStore()\n  }\n\n  return (\n    <div>\n      <Notify error={error} setError={setError} />  \n      <div>\n        { \n        !token ?\n        <button onClick={() => setPage('login')}>login</button>\n        : \n        <>\n        <button onClick={() => handleLogout()} >log out</button>\n        <button onClick={() => setPage('add')}>add book</button>\n        <button onClick={() => setPage('recommended')}>recommended</button>       \n        </>\n        }\n        <button onClick={() => setPage('authors')}>authors</button>\n        <button onClick={() => setPage('books')}>books</button>       \n      </div>\n\n      <LoginForm \n        setError={setError} \n        setToken={setToken} \n        show={page === \"login\"}\n        setPage={setPage}\n      />\n\n      <Authors\n        show={page === 'authors'}\n        setError={setError}\n        token={token}\n      />\n\n      <Books\n        show={page === 'books'}\n        setError={setError}\n      />\n\n      <Recommended\n        show={page === 'recommended'}\n        setError={setError}\n      />\n\n      <NewBook\n        show={page === 'add'}\n        setError={setError}\n        updateCacheWith={updateCacheWith}\n      />\n\n    </div>\n  )\n}\n\nconst Notify = ({error, setError}) => {  \n  if (!error) return null   \n\n  setTimeout(() => setError(null), 3000)\n  return (    \n    <div style={{color: 'red'}}>    \n    {error}    \n    </div>  \n  )\n}\n\nexport default App"]},"metadata":{},"sourceType":"module"}